<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarAuction - User Dashboard</title>
    <!-- Firebase and Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="dashboard">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <button class="mobile-menu-btn" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>CarAuction</h1>
            </div>
            <div class="user-info">
                <div class="notifications">
                    <i class="fas fa-bell"></i>
                    <div class="badge" id="notification-count">0</div>
                </div>
                <div class="profile">
                    <img src="https://ui-avatars.com/api/?name=User&background=3a86ff&color=fff" alt="User" id="user-avatar">
                    <div>
                        <div id="user-name">User</div>
                        <div class="role" id="user-role">Buyer</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Overlay -->
        <div class="overlay" id="overlay"></div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <ul class="nav-links">
                <li><a href="#" class="active" data-page="dashboard"><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
                <li id="nav-my-cars"><a href="#" data-page="my-cars"><i class="fas fa-car"></i> <span>My Cars</span></a></li>
                <li id="nav-list-car"><a href="#" data-page="list-car"><i class="fas fa-plus-circle"></i> <span>List a Car</span></a></li>
                <li><a href="#" data-page="auctions"><i class="fas fa-gavel"></i> <span>Live Auctions</span></a></li>
                <li><a href="#" data-page="my-bids"><i class="fas fa-hand-holding-usd"></i> <span>My Bids</span></a></li>
                <li id="nav-my-sales"><a href="#" data-page="my-sales"><i class="fas fa-chart-line"></i> <span>My Sales</span></a></li>
                <li><a href="#" data-page="favorites"><i class="fas fa-heart"></i> <span>Favorites</span></a></li>
                <li><a href="#" data-page="profile"><i class="fas fa-user"></i> <span>Profile</span></a></li>
                <li><a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-wrapper">
                
                <!-- Dashboard Content -->
                <div id="dashboard-content">
                    <div class="top-bar">
                        <h2>Welcome Back, <span id="welcome-name">User</span>!</h2>
                        <button class="btn btn-primary" id="refresh-dashboard-btn">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>

                    <!-- Stats Cards -->
                    <div class="dashboard-cards">
                        <div class="card" id="card-my-cars">
                            <div class="card-header">
                                <h3>My Listings</h3>
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="card-body">
                                <h2 id="stat-my-cars">0</h2>
                                <p><span class="status-badge status-active" id="stat-active-listings">0 active</span></p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3>Active Bids</h3>
                                <i class="fas fa-gavel"></i>
                            </div>
                            <div class="card-body">
                                <h2 id="stat-active-bids">0</h2>
                                <p><span class="status-badge status-pending" id="stat-winning">0 winning</span></p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3>Watchlist</h3>
                                <i class="fas fa-heart"></i>
                            </div>
                            <div class="card-body">
                                <h2 id="stat-favorites">0</h2>
                                <p>Saved cars</p>
                            </div>
                        </div>
                        <div class="card" id="card-earnings">
                            <div class="card-header">
                                <h3>Total Earnings</h3>
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="card-body">
                                <h2 id="stat-earnings">R0</h2>
                                <p><span class="status-badge status-success" id="stat-sold-cars">0 cars sold</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <h2 class="section-title">Quick Actions</h2>
                    <div class="dashboard-cards">
                        <div class="card" style="cursor: pointer;" onclick="navigateTo('list-car')" id="action-list-car">
                            <div class="card-body text-center">
                                <i class="fas fa-plus-circle" style="font-size: 3rem; color: var(--primary); margin-bottom: 10px;"></i>
                                <h3>List Your Car</h3>
                                <p>Start selling your vehicle</p>
                            </div>
                        </div>
                        <div class="card" style="cursor: pointer;" onclick="navigateTo('auctions')">
                            <div class="card-body text-center">
                                <i class="fas fa-search" style="font-size: 3rem; color: var(--success); margin-bottom: 10px;"></i>
                                <h3>Browse Auctions</h3>
                                <p>Find your dream car</p>
                            </div>
                        </div>
                        <div class="card" style="cursor: pointer;" onclick="navigateTo('my-bids')">
                            <div class="card-body text-center">
                                <i class="fas fa-history" style="font-size: 3rem; color: var(--warning); margin-bottom: 10px;"></i>
                                <h3>Track Bids</h3>
                                <p>Monitor your activity</p>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <h2 class="section-title">Recent Activity</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Activity</th>
                                    <th>Car</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recent-activity-body">
                                <tr><td colspan="5" class="text-center">No recent activity</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- My Cars Content (Seller) -->
                <div id="my-cars-content" class="hidden">
                    <div class="top-bar">
                        <h2>My Car Listings</h2>
                        <button class="btn btn-primary" onclick="navigateTo('list-car')">
                            <i class="fas fa-plus"></i> List New Car
                        </button>
                    </div>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="all-my-cars">All</div>
                        <div class="tab" data-tab="pending-my-cars">Pending Approval</div>
                        <div class="tab" data-tab="approved-my-cars">Approved</div>
                        <div class="tab" data-tab="on-auction-my-cars">On Auction</div>
                    </div>
                    
                    <div class="tab-content active" id="all-my-cars-tab">
                        <div id="my-cars-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                            <!-- Cars will be loaded dynamically -->
                        </div>
                    </div>
                </div>

                <!-- List Car Content (Seller) -->
                <div id="list-car-content" class="hidden">
                    <div class="top-bar">
                        <h2>List Your Car for Auction</h2>
                    </div>
                    
                    <div class="card">
                        <form id="list-car-form" style="padding: 20px;">
                            <h3 class="mb-20">Car Details</h3>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="form-group">
                                    <label for="car-brand">Brand *</label>
                                    <input type="text" id="car-brand" class="form-control" required placeholder="e.g., Toyota">
                                </div>
                                
                                <div class="form-group">
                                    <label for="car-model">Model *</label>
                                    <input type="text" id="car-model" class="form-control" required placeholder="e.g., Corolla">
                                </div>
                                
                                <div class="form-group">
                                    <label for="car-year">Year *</label>
                                    <input type="number" id="car-year" class="form-control" required min="1900" max="2025" placeholder="e.g., 2020">
                                </div>
                                
                                <div class="form-group">
                                    <label for="car-price">Starting Price (R) *</label>
                                    <input type="number" id="car-price" class="form-control" required min="0" placeholder="e.g., 150000">
                                </div>
                                
                                <div class="form-group">
                                    <label for="car-mileage">Mileage (km) *</label>
                                    <input type="number" id="car-mileage" class="form-control" required min="0" placeholder="e.g., 45000">
                                </div>
                                
                                <div class="form-group">
                                    <label for="car-condition">Condition *</label>
                                    <select id="car-condition" class="form-control" required>
                                        <option value="">Select condition</option>
                                        <option value="excellent">Excellent</option>
                                        <option value="good">Good</option>
                                        <option value="fair">Fair</option>
                                        <option value="needs-work">Needs Work</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="car-color">Color *</label>
                                    <input type="text" id="car-color" class="form-control" required placeholder="e.g., White">
                                </div>
                                
                                <div class="form-group">
                                    <label for="car-transmission">Transmission *</label>
                                    <select id="car-transmission" class="form-control" required>
                                        <option value="">Select transmission</option>
                                        <option value="automatic">Automatic</option>
                                        <option value="manual">Manual</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="car-description">Description *</label>
                                <textarea id="car-description" class="form-control" rows="4" required placeholder="Describe your car's features, condition, service history, etc."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="car-images">Car Images (Max 5)</label>
                                <input type="file" id="car-images" class="form-control" multiple accept="image/*" style="padding: 10px;">
                                <p style="color: var(--gray); font-size: 0.85rem; margin-top: 5px;">Upload high-quality images of your car from different angles</p>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                                <i class="fas fa-upload"></i> Submit for Approval
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Live Auctions Content -->
                <div id="auctions-content" class="hidden">
                    <div class="top-bar">
                        <h2>Live Auctions</h2>
                        <div class="search-bar" style="min-width: 300px;">
                            <i class="fas fa-search"></i>
                            <input type="text" id="auction-search" placeholder="Search by brand, model...">
                        </div>
                    </div>
                    
                    <div id="auctions-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px;">
                        <!-- Auctions will be loaded dynamically -->
                    </div>
                </div>

                <!-- My Bids Content -->
                <div id="my-bids-content" class="hidden">
                    <div class="top-bar">
                        <h2>My Bids & Watching</h2>
                    </div>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="active-bids">Active Bids</div>
                        <div class="tab" data-tab="won-bids">Won</div>
                        <div class="tab" data-tab="lost-bids">Lost</div>
                    </div>
                    
                    <div class="tab-content active" id="active-bids-tab">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Car</th>
                                        <th>Your Bid</th>
                                        <th>Current Bid</th>
                                        <th>Time Left</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="active-bids-body">
                                    <tr><td colspan="6" class="text-center">No active bids</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- My Sales Content (Seller) -->
                <div id="my-sales-content" class="hidden">
                    <div class="top-bar">
                        <h2>Sales History</h2>
                    </div>
                    
                    <div class="admin-stats" style="margin-bottom: 30px;">
                        <div class="chart-container">
                            <h3 class="mb-20">Sales Performance</h3>
                            <canvas id="salesChart" height="250"></canvas>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-icon" style="background-color: rgba(6, 214, 160, 0.2); color: var(--success);">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="stat-info">
                                    <h4>Total Sales</h4>
                                    <p id="total-sales-count">0</p>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon" style="background-color: rgba(58, 134, 255, 0.2); color: var(--primary);">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                                <div class="stat-info">
                                    <h4>Total Revenue</h4>
                                    <p id="total-revenue">R0</p>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon" style="background-color: rgba(255, 209, 102, 0.2); color: var(--warning);">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-info">
                                    <h4>Average Price</h4>
                                    <p id="avg-sale-price">R0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Car</th>
                                    <th>Buyer</th>
                                    <th>Final Price</th>
                                    <th>Sale Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="sales-history-body">
                                <tr><td colspan="5" class="text-center">No sales yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Favorites Content -->
                <div id="favorites-content" class="hidden">
                    <div class="top-bar">
                        <h2>My Favorites</h2>
                    </div>
                    
                    <div id="favorites-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                        <!-- Favorites will be loaded dynamically -->
                    </div>
                </div>

                <!-- Profile Content -->
                <div id="profile-content" class="hidden">
                    <div class="top-bar">
                        <h2>My Profile</h2>
                    </div>
                    
                    <div class="card">
                        <form id="profile-form" style="padding: 20px;">
                            <div style="text-align: center; margin-bottom: 30px;">
                                <img src="https://ui-avatars.com/api/?name=User&background=3a86ff&color=fff" alt="Profile" id="profile-avatar" style="width: 120px; height: 120px; border-radius: 50%; margin-bottom: 15px;">
                                <div>
                                    <input type="file" id="profile-photo" accept="image/*" style="display: none;">
                                    <button type="button" class="btn btn-outline" onclick="document.getElementById('profile-photo').click()">
                                        <i class="fas fa-camera"></i> Change Photo
                                    </button>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="form-group">
                                    <label for="profile-name">Full Name</label>
                                    <input type="text" id="profile-name" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="profile-email">Email</label>
                                    <input type="email" id="profile-email" class="form-control" disabled>
                                </div>
                                
                                <div class="form-group">
                                    <label for="profile-phone">Phone</label>
                                    <input type="tel" id="profile-phone" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="profile-role">Role</label>
                                    <input type="text" id="profile-role" class="form-control" disabled>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="profile-address">Address</label>
                                <textarea id="profile-address" class="form-control" rows="3"></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </form>
                    </div>
                </div>

            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Created By: Sipho Mtshali | Â©2024 | All Rights Reserved.</p>
        </div>
    </div>

    <!-- Bid Modal -->
    <div class="modal" id="bid-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Place Your Bid</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div id="bid-modal-body">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>
    <script src="../js/firebase-config.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/user.js"></script>
</body>
</html>